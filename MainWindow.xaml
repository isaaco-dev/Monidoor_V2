<Window x:Class="MoniraceWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:MoniraceWPF"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        Title="MONIRACE PRO - Digital Display POC" Height="840" Width="460"
        WindowStyle="None" ResizeMode="NoResize" Background="Black">
    
    <Window.Resources>
        <Color x:Key="MoniraceBlueColor">#00bcd4</Color>
        <Color x:Key="MoniraceRedColor">#ff3b30</Color>
        <SolidColorBrush x:Key="MoniraceBlue" Color="{StaticResource MoniraceBlueColor}"/>
        <SolidColorBrush x:Key="MoniraceRed" Color="{StaticResource MoniraceRedColor}"/>
        <SolidColorBrush x:Key="BackgroundDark" Color="#000000"/>
        <SolidColorBrush x:Key="TileBackground" Color="#1a1a1a"/>
        <SolidColorBrush x:Key="TextLight" Color="#f0f0f0"/>
        
        <local:BooleanInverseConverter x:Key="InverseBooleanConverter"/>
        <local:StatusPenConverter x:Key="StatusPenConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <Style TargetType="Button" x:Key="AppTileBaseStyle">
            <Setter Property="Height" Value="95"/>
            <Setter Property="Background" Value="{StaticResource TileBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource TextLight}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderThickness" Value="3"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="12" Padding="5"
                                Effect="{TemplateBinding Effect}">
                            <TextBlock Text="{TemplateBinding Content}" VerticalAlignment="Center" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#333333"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.4"/>
                    <Setter Property="Cursor" Value="None"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                    <Setter Property="Background" Value="{StaticResource TileBackground}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="Button" x:Key="AppTileTopStyle" BasedOn="{StaticResource AppTileBaseStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsSelectedTop}" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource MoniraceRed}"/>
                    <Setter Property="Foreground" Value="{StaticResource MoniraceRed}"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="{StaticResource MoniraceRedColor}" ShadowDepth="0" BlurRadius="10" Opacity="0.9"/>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="Button" x:Key="AppTileBottomStyle" BasedOn="{StaticResource AppTileBaseStyle}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsSelectedBottom}" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource MoniraceBlue}"/>
                    <Setter Property="Foreground" Value="{StaticResource MoniraceBlue}"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="{StaticResource MoniraceBlueColor}" ShadowDepth="0" BlurRadius="10" Opacity="0.9"/>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="Button" x:Key="LaunchButtonStyle">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource MoniraceBlue}"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="BorderBrush" Value="{StaticResource MoniraceBlue}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
             <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource MoniraceBlue}"/>
                    <Setter Property="Foreground" Value="White"/>
                </Trigger>
                 <Trigger Property="IsEnabled" Value="False">
                     <Setter Property="Opacity" Value="0.3"/>
                 </Trigger>
            </Style.Triggers>
        </Style>

        <LinearGradientBrush x:Key="SeparatorGradient" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="Transparent" Offset="0"/>
            <GradientStop Color="#444444" Offset="0.5"/>
            <GradientStop Color="Transparent" Offset="1"/>
        </LinearGradientBrush>
    
    </Window.Resources>

    <Border Background="{StaticResource BackgroundDark}" CornerRadius="30" Padding="20" 
            BorderThickness="10" BorderBrush="#111">
        
        <Grid>
            <Grid x:Name="AppSelectionGrid" Visibility="{Binding IsSelectionViewVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" HorizontalAlignment="Center" Margin="0,0,0,20">
                    <TextBlock Text="MONIRACE" FontSize="40" FontWeight="ExtraBlack" Foreground="{StaticResource MoniraceBlue}" TextAlignment="Center" Margin="0,10,0,2"/> 
                    <TextBlock Text="La tua performance in ogni dettaglio" FontSize="15" Foreground="{StaticResource MoniraceRed}" FontWeight="SemiBold" TextAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Row="1" HorizontalAlignment="Center" Margin="0,0,0,15">
                    <TextBlock Text="{Binding SelectionStatusText}" FontSize="18" FontWeight="SemiBold" TextAlignment="Center"
                               Margin="0,0,0,10" Foreground="{StaticResource TextLight}">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SelectionStatusText}" Value="GO! La tua COMBINAZIONE Ã¨ pronta ðŸš¥">
                                        <Setter Property="Foreground" Value="{StaticResource MoniraceBlue}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding SelectionStatusText}" Value="Slot BOTTOM: Scegli i tuoi DATI DI ANALISI ðŸ“ˆ">
                                        <Setter Property="Foreground" Value="{StaticResource MoniraceRed}"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                        <TextBlock.TextDecorations>
                            <TextDecoration Location="Underline" Pen="{Binding SelectionStatusText, Converter={StaticResource StatusPenConverter}}"/>
                        </TextBlock.TextDecorations>
                    </TextBlock>
                </StackPanel>

                <ItemsControl Grid.Row="2" ItemsSource="{Binding AppList}" Margin="0,0,0,10">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Columns="3" Margin="0"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Content="{Binding Name}" Style="{StaticResource AppTileTopStyle}" 
                                    Command="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}, Path=DataContext.SelectAppTopCommand}" 
                                    CommandParameter="{Binding}"
                                    IsEnabled="{Binding IsDisabledTop, Converter={StaticResource InverseBooleanConverter}}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <Button Grid.Row="3" Content="APRI DOPPIA VISUALIZZAZIONE" Command="{Binding LaunchSplitViewCommand}" 
                        Style="{StaticResource LaunchButtonStyle}" Margin="0,10,0,10"/>

                <Border Grid.Row="4" Height="5" Background="{StaticResource SeparatorGradient}" Margin="0,20"/>

                <ItemsControl Grid.Row="5" ItemsSource="{Binding AppList}" Margin="0,10,0,0">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <UniformGrid Columns="3" Margin="0"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Button Content="{Binding Name}" Style="{StaticResource AppTileBottomStyle}" 
                                    Command="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}, Path=DataContext.SelectAppBottomCommand}" 
                                    CommandParameter="{Binding}"
                                    IsEnabled="{Binding IsDisabledBottom, Converter={StaticResource InverseBooleanConverter}}"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <StackPanel Grid.Row="6" HorizontalAlignment="Center" Margin="0,30,0,10">
                    <TextBlock FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextLight}" TextAlignment="Center" Margin="0,0,0,5">
                        <TextBlock.TextDecorations>
                            <TextDecoration Location="Underline" Pen="{StaticResource MoniraceBlue}"/>
                        </TextBlock.TextDecorations>
                        Applicazioni disponibili: <Run Text="{Binding AppList.Count}"/>
                    </TextBlock>
                    <TextBlock Text="Â© 2025 Monidoor Ã¨ un prodotto di SBM S.r.l." FontSize="14" Foreground="#999999" TextAlignment="Center"/>
                </StackPanel>
            </Grid>

            <Grid x:Name="SplitViewGrid" Visibility="{Binding IsSplitViewVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Grid Grid.Row="0">
                    <Border BorderBrush="#333" BorderThickness="2" CornerRadius="15" Background="White">
                        <wv2:WebView2 x:Name="TopWebView" Source="{Binding TopAppUrl}"/>
                    </Border>
                    <Button Command="{Binding ShowSelectionCommand}" Style="{StaticResource BackButtonStyle}"/>
                </Grid>

                <Border Grid.Row="1" Background="Transparent"/>

                <Grid Grid.Row="2">
                    <Border BorderBrush="#333" BorderThickness="2" CornerRadius="15" Background="White">
                        <wv2:WebView2 x:Name="BottomWebView" Source="{Binding BottomAppUrl}"/>
                    </Border>
                    <Button Command="{Binding ShowSelectionCommand}" Style="{StaticResource BackButtonStyle}"/>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>